\chapter{Mathematical formulation}
\label{matmod}

The model is essentially an assignment problem where each patient gets assigned a vehicle's route and a production job. See \ref{def} for more information on the terminology used.

\section{Sets}


%* Production lines: each production line that can be used to produce dosages.
%* Job types: each one of the different ways that dosages can be produced.
%* Vehicles: each transport that can be used simmultaneously to take dosages from the production center to the demand centers.
%* Centers: each of the physical locations where dosages are applied to patients.
%* Jobs: each production batch that is done at every production line. Each job has only one job type.
%* Routes: each of the travels that every vehicle does when being used.
%* Patients: each of the patients that needs dosages.

\begin{tabular}{p{15mm}lp{105mm}}
    $\mathcal{L}$    & : & all production lines \\
    $\mathcal{T}$    & : & all job types \\                    
    $\mathcal{V}$    & : & all vehicles \\    
    $\mathcal{C}$    & : & all centers \\    
    $\mathcal{J}$    & : & all jobs \\    
    $\mathcal{R}$    & : & all routes \\    
    $\mathcal{P}$    & : & all patients \\
\end{tabular}
\bigskip

\section{Decision variables}

\subsection{Production variables}

\begin{tabular}{p{15mm}lp{105mm}}
    $lineUsed_{l}$    & : & 1 if line $l \in \mathcal{L}$ will be used  \\  
    $jobUsed_{j}$    & : & 1 if job $j \in \mathcal{J}$ will be used  \\  
    $jobType_{jt}$    & : & 1 if job type $t \in \mathcal{T}$ is assigned to job $j \in \mathcal{J}$ \\  
    $jobST_{j}$    & : & minute at which the job $j \in \mathcal{J}$ starts \\  
%    $jobProd_{j}$    & : & minute at which the job $j \in \mathcal{J}$ starts \\  
%    $jobTime_{j}$    & : & minute at which the job $j \in \mathcal{J}$ starts \\  
\end{tabular}
\bigskip

\subsection{Transport variables}

\begin{tabular}{p{30mm}lp{90mm}}
    $routeUsed_{r}$    & : & 1 if route $r \in \mathcal{R}$ will be used  \\  
    $vehicleUsed_{v}$    & : & 1 if vehicle $v \in \mathcal{V}$ will be used  \\  
    $routeArrival_{rc}$    & : & minute at which route $r \in \mathcal{R}$ arrives to center $c \in \mathcal{C}$ \\  
    $routeST_{r}$    & : & minute at which the route $r \in \mathcal{R}$ starts \\
    $routeArc_{rcc'}$    & : & 1 if route $r \in \mathcal{R}$ visits center $c'$ inmediately after center $c'$  \\
    $routeET_{r}$    & : & minute at which the route $r \in \mathcal{R}$ finishes \\
\end{tabular}
\bigskip

\subsection{Demand variables}

\begin{tabular}{p{30mm}lp{90mm}}
    $routeJobPatient_{rjp}$    & : & 1 if route $r$ will be used to transport a dosage from job $j$ to patient $p$ \\  
    $routeJob_{rj}$    & : & 1 if route $r$ is used to transport dosages for job $j$ \\  
    $jobPatient_{jp}$    & : & 1 if job $j$ is used to produce dosages for patient $p$ \\  
    $routePatient_{rp}$    & : & 1 if route $r$ is used to transport dosages for patient $p$\\
\end{tabular}
\bigskip


\section{Constraints}


\begin{align}
\mbox{MIN} \quad &
                     \sum_{a \in \mathcal{A},c \in \mathcal{C}}C^{T}_{R_ac}n_{ac}    \label{eq:fo1}\\
\mbox{s. t.:} \quad &  \notag \\		
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % all shops are audited
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             & \sum_{a \in \mathcal{A}}n_{ac}\geq N_c 
               \hspace{10mm} c \in \mathcal{CT}\label{eq:allaudited}\\		
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % the number of audit for auditor is upper bounded by the time horizon
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             & \sum_{c \in \mathcal{CT}}n_{ac}\leq (2-PART_a)\times D 
               \hspace{10mm} a \in \mathcal{A}\label{eq:upperbound}\\
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % consitency
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             & n_{ac}\leq x_{ac}N_c
               \hspace{10mm} a \in \mathcal{A}\, c \in \mathcal{CT}\label{eq:consistency1}\\		  		  
    %%%%%%%%%%%%%%%%%%%%%%%%%%
    % variables domains
    %%%%%%%%%%%%%%%%%%%%%%%%%%
             & x_{ac}  \in \{0,1\}
               \hspace{10mm} a \in \mathcal{A}, \, c \in \mathcal{CT}
               \label{eq:dom-x} \\
             & n_{ac}  \geq 0
               \hspace{10mm} a \in \mathcal{A}, \, c \in \mathcal{CT}
               \label{eq:dom-xS} \\
\end{align}	